<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Admin - Chat Anónimo</title>
</head>
<body>
    <h1>Debug Sistema Administrador</h1>
    
    <div>
        <h2>Crear salas de prueba</h2>
        <button onclick="crearSalaDePrueba()">🏗️ Crear Sala de Prueba</button>
        <button onclick="crearVariasSalas()">🏗️ Crear 3 Salas</button>
    </div>
    
    <div>
        <h2>Testing funciones admin</h2>
        <button onclick="testGetAllRooms()">🔍 Test getAllRooms()</button>
        <button onclick="testGetAllRoomsAdmin()">🔍 Test getAllRooms(true)</button>
        <button onclick="testAdminListRooms()">📋 Test adminListRooms()</button>
    </div>
    
    <div>
        <h2>Información del sistema</h2>
        <button onclick="mostrarLocalStorage()">💾 Mostrar localStorage</button>
        <button onclick="limpiarTodo()">🗑️ Limpiar Todo</button>
    </div>
    
    <div id="output" style="margin-top: 20px; padding: 10px; background: #f0f0f0; white-space: pre-wrap; font-family: monospace;"></div>

    <script src="app.js"></script>
    <script>
        // Crear instancia de la app para testing
        const app = new AnonymousChatApp();
        const output = document.getElementById('output');
        
        function log(message) {
            output.textContent += new Date().toLocaleTimeString() + ' - ' + message + '\n';
            console.log(message);
        }
        
        function crearSalaDePrueba() {
            const roomId = 'TEST' + Math.floor(Math.random() * 1000);
            const room = {
                id: roomId,
                creator: 'Admin Test',
                question: 'Sala de prueba para debugging',
                createdAt: new Date().toISOString(),
                expiresAt: new Date(Date.now() + 7200000).toISOString(), // 2 horas
                messageLimit: 50,
                messages: [{
                    id: Date.now(),
                    text: 'Mensaje de prueba',
                    isAnonymous: false,
                    author: 'Admin Test',
                    timestamp: new Date().toISOString(),
                    votes: { likes: 0, dislikes: 0 }
                }]
            };
            
            localStorage.setItem(`room_${roomId}`, JSON.stringify(room));
            log(`✅ Sala creada: ${roomId}`);
        }
        
        function crearVariasSalas() {
            for(let i = 1; i <= 3; i++) {
                setTimeout(() => crearSalaDePrueba(), i * 100);
            }
        }
        
        function testGetAllRooms() {
            const rooms = app.getAllRooms();
            log(`📋 getAllRooms() encontró: ${rooms.length} salas`);
            rooms.forEach((room, index) => {
                log(`  ${index + 1}. ${room.id} - ${room.creator} - ${room.messages?.length || 0} mensajes`);
            });
        }
        
        function testGetAllRoomsAdmin() {
            const rooms = app.getAllRooms(true);
            log(`📋 getAllRooms(true) encontró: ${rooms.length} salas`);
            rooms.forEach((room, index) => {
                const expired = app.isRoomExpired(room) ? ' (EXPIRADA)' : ' (ACTIVA)';
                log(`  ${index + 1}. ${room.id} - ${room.creator}${expired} - ${room.messages?.length || 0} mensajes`);
            });
        }
        
        function testAdminListRooms() {
            log('🔍 Ejecutando adminListRooms()...');
            app.adminListRooms();
        }
        
        function mostrarLocalStorage() {
            log('💾 Contenido de localStorage:');
            const keys = Object.keys(localStorage);
            const roomKeys = keys.filter(key => key.startsWith('room_'));
            log(`  Total de claves: ${keys.length}`);
            log(`  Claves de salas: ${roomKeys.length}`);
            
            roomKeys.forEach(key => {
                try {
                    const room = JSON.parse(localStorage.getItem(key));
                    log(`  - ${key}: ${room.id} (${room.creator})`);
                } catch (error) {
                    log(`  - ${key}: ERROR al parsear`);
                }
            });
        }
        
        function limpiarTodo() {
            const keys = Object.keys(localStorage);
            const roomKeys = keys.filter(key => key.startsWith('room_'));
            roomKeys.forEach(key => localStorage.removeItem(key));
            log(`🗑️ Eliminadas ${roomKeys.length} salas de localStorage`);
            output.textContent = '';
        }
        
        // Auto-mostrar información inicial
        setTimeout(() => {
            log('🚀 Sistema de debugging cargado');
            mostrarLocalStorage();
        }, 1000);
    </script>
</body>
</html>