<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Chat An√≥nimo - Espacios de di√°logo honesto</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Pantalla de bienvenida -->
    <div id="welcomeScreen" class="screen active">
        <div class="container">
            <div class="welcome-content">
                <div class="logo">
                    <h1>üí¨ Chat An√≥nimo</h1>
                    <p>Crea espacios de di√°logo honestos y sin prejuicios</p>
                </div>
                
                <div class="welcome-actions">
                    <button id="joinRoomBtn" class="btn btn--primary btn--lg btn--full-width">
                        Unirse a Sala
                    </button>
                </div>

                <div class="privacy-notice">
                    <p><small>üîí Tus datos se almacenan localmente en tu dispositivo</small></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Pantalla de crear sala -->
    <div id="createRoomScreen" class="screen">
        <div class="container">
            <div class="screen-header">
                <button id="backToWelcome" class="btn-back">‚Üê Volver</button>
                <h2>Crear Nueva Sala</h2>
            </div>

            <form id="createRoomForm" class="form">
                <div class="form-group">
                    <label for="creatorName" class="form-label">Tu nombre (visible solo en la pregunta inicial)</label>
                    <input type="text" id="creatorName" class="form-control" placeholder="Ej: Mar√≠a, Dr. L√≥pez..." maxlength="50" required>
                </div>

                <div class="form-group">
                    <label for="initialQuestion" class="form-label">Escribe tu pregunta para iniciar el di√°logo</label>
                    <textarea id="initialQuestion" class="form-control" rows="4" placeholder="¬øCu√°l es tu pregunta?" maxlength="300" required></textarea>
                    <small class="form-help">M√°ximo 300 caracteres</small>
                </div>

                <button type="submit" class="btn btn--primary btn--lg btn--full-width">
                    Crear Sala
                </button>
            </form>
        </div>
    </div>

    <!-- Pantalla de unirse a sala -->
    <div id="joinRoomScreen" class="screen">
        <div class="container">
            <div class="screen-header">
                <button id="backToWelcomeFromJoin" class="btn-back">‚Üê Volver</button>
                <h2>Unirse a Sala</h2>
            </div>

            <form id="joinRoomForm" class="form">
                <div class="form-group">
                    <label for="roomCode" class="form-label">C√≥digo de sala</label>
                    <input type="text" id="roomCode" class="form-control" placeholder="Ej: ROOM123" maxlength="10" required>
                </div>

                <button type="submit" class="btn btn--primary btn--lg btn--full-width">
                    Unirse a Sala
                </button>
            </form>
        </div>
    </div>

    <!-- Pantalla principal del chat -->
    <div id="chatScreen" class="screen">
        <div class="chat-container">
            <div id="chatMessages" class="chat-messages">
                <!-- Los mensajes se insertan aqu√≠ din√°micamente -->
            </div>
            
            <!-- Secci√≥n de archivos adjuntos -->
            <div id="attachmentsSection" class="attachments-section hidden">
                <div class="attachments-header">
                    <h4>üìÅ Archivos de la sala</h4>
                    <button id="toggleAttachments" class="btn btn--sm">‚Üì</button>
                </div>
                <div id="attachmentsList" class="attachments-list">
                    <!-- PDFs se muestran aqu√≠ -->
                </div>
            </div>
        </div>

        <div class="chat-input-container">
            <form id="messageForm" class="message-form">
                <div class="input-group">
                    <div class="message-input-wrapper">
                        <textarea id="messageInput" class="form-control message-input" placeholder="Escribe tu respuesta an√≥nima..." maxlength="280" rows="4"></textarea>
                        <div class="input-actions">
                            <button id="uploadPDFBtn" class="btn-attachment" title="Subir PDF" type="button">
                                üìé
                            </button>
                            <input type="file" id="pdfFileInput" accept=".pdf" style="display: none;">
                        </div>
                    </div>
                    <button type="submit" class="btn btn--primary send-btn" disabled>
                        Enviar
                    </button>
                </div>
                <small class="character-count">0/280</small>
            </form>
        </div>

        <div class="chat-bottom-bar">
            <div class="chat-info-compact">
                <span id="roomCodeDisplay" class="room-code-compact">ROOM123</span>
                <span id="connectionStatus" class="connection-status-compact">
                    <span class="connection-indicator"></span>
                </span>
                <span id="messageCounter" class="counter-compact">üí¨ --/--</span>
            </div>
            <div class="chat-actions-compact">
                <button id="shareRoomBtn" class="btn btn--xs" style="display: none;">üì§</button>
                <button id="themeToggleBtn" class="btn btn--xs" title="Cambiar tema">
                    <span class="theme-icon">üåô</span>
                </button>
                <button id="refreshRoomBtn" class="btn btn--xs" title="Actualizar">üîÑ Actualizar</button>
                <button id="aiAnalysisBtn" class="btn btn--xs" title="An√°lisis IA">ü§ñ IA</button>
                <button id="leaveRoomBtn" class="btn btn--xs">Salir</button>
            </div>
        </div>
    </div>

    <!-- Modal de c√≥digo de sala -->
    <div id="roomCodeModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>¬°Sala Creada!</h3>
                <button id="closeModal" class="btn-close">√ó</button>
            </div>
            <div class="modal-body">
                <p>Comparte este c√≥digo con otros para que se unan:</p>
                <div class="room-code-display">
                    <code id="displayRoomCode">ROOM123</code>
                    <button id="copyCodeBtn" class="btn btn--sm">Copiar</button>
                </div>
                <p><small>El c√≥digo se ha copiado autom√°ticamente al portapapeles</small></p>
            </div>
            <div class="modal-footer">
                <button id="startChatBtn" class="btn btn--primary btn--full-width">
                    Comenzar Chat
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de confirmaci√≥n -->
    <div id="confirmModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmTitle">Confirmar acci√≥n</h3>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">¬øEst√°s seguro?</p>
            </div>
            <div class="modal-footer">
                <button id="cancelBtn" class="btn btn--outline">Cancelar</button>
                <button id="confirmBtn" class="btn btn--primary">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Toast para notificaciones -->
    <div id="toast" class="toast hidden">
        <span id="toastMessage"></span>
    </div>

    <!-- Modal de An√°lisis IA -->
    <div id="aiAnalysisModal" class="modal hidden ai-modal">
        <div class="modal-content ai-modal-content">
            <div class="modal-header">
                <h3>ü§ñ An√°lisis IA del Chat</h3>
                <button id="closeAiModal" class="btn-close" onclick="aiManager.closeAnalysisModal()">√ó</button>
            </div>
            <div class="modal-body ai-modal-body">
                <div class="ai-analysis-options">
                    <h4>Selecciona el tipo de an√°lisis:</h4>
                    <div class="ai-options-grid">
                        <button id="analysisOptionSentiment" class="ai-option-btn">
                            <div class="ai-option-icon">üòä</div>
                            <div class="ai-option-title">An√°lisis de Sentimientos</div>
                            <div class="ai-option-desc">Detecta emociones y tono de la conversaci√≥n</div>
                        </button>
                        
                        <button id="analysisOptionTopic" class="ai-option-btn">
                            <div class="ai-option-icon">üìã</div>
                            <div class="ai-option-title">An√°lisis Tem√°tico</div>
                            <div class="ai-option-desc">Identifica temas principales y palabras clave</div>
                        </button>
                        
                        <button id="analysisOptionSummary" class="ai-option-btn">
                            <div class="ai-option-icon">üìù</div>
                            <div class="ai-option-title">Resumen</div>
                            <div class="ai-option-desc">Genera un resumen conciso de la conversaci√≥n</div>
                        </button>
                    </div>
                </div>
                
                <div id="aiAnalysisResult" class="ai-analysis-result">
                    <div class="ai-placeholder">
                        <p>ü§ñ Selecciona un tipo de an√°lisis para comenzar</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="closeAiAnalysis" class="btn btn--outline" onclick="aiManager.closeAnalysisModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal para preview de PDFs -->
    <div id="pdfPreviewModal" class="modal hidden pdf-modal">
        <div class="modal-content pdf-modal-content">
            <div class="modal-header">
                <h3 id="pdfPreviewTitle">Vista previa PDF</h3>
                <button id="closePdfModal" class="btn-close">√ó</button>
            </div>
            <div class="modal-body pdf-modal-body">
                <iframe id="pdfPreviewFrame" src="" width="100%" height="600px" style="border: none;"></iframe>
            </div>
            <div class="modal-footer">
                <button id="downloadPdfBtn" class="btn btn--outline">‚¨áÔ∏è Descargar</button>
                <button id="closePdfPreview" class="btn btn--primary">Cerrar</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="env.js"></script>
    <script src="supabase-client.js"></script>
    <script type="module" src="app.js"></script>
</body>
</html>